import pickle
import numpy as np
import os
from sklearn.cluster import KMeans

# Clustering 11labs speaker embeddings

folder_path = "embedding"
embeddings = []
file_names = []

file_list = sorted(os.listdir(folder_path))
for file in file_list:
    if file.endswith(".pkl"):
        with open(os.path.join(folder_path, file), "rb") as f:
            data = pickle.load(f)
            embeddings.append(data)
            file_names.append(file)

embeddings = np.vstack(embeddings)
kmeans = KMeans(n_clusters=10, random_state=42, n_init=10)
labels = kmeans.fit_predict(embeddings)

cluster_mapping = dict(zip(file_names, labels))

with open("cluster_mapping.pkl", "wb") as f:
    pickle.dump(cluster_mapping, f)
